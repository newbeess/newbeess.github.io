<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Stock-Span-Problem | Code Stuff</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Stock-Span-Problem</h1><a id="logo" href="/.">Code Stuff</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Stock-Span-Problem</h1><div class="post-meta">Apr 19, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p><code>We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days before the given day where the price of stock was less than or equal to price at given day. For example, {100, 60,70,65, 80, 85} span will be {1, 1, 2, 1, 4, 5}  
 For first day span is always 1. In example we can see that for day 2 at 60, there is no day before it where price was less than 60. Hence span is 1 again. For day 3, price at day 2 (60) is less than 70, hence span is 2. Similarly, for day 4 and day 5. Remember days should be consecutive, that why span for day 4 is 1 even though there was a day 2 where price was less than 65. Hope this example clarifies the problem. Stock span problem is slightly complicated to understand but solution is pretty easy.</code> </p>
<p>这是最近在<a href="https://www.youtube.com/iit" target="_blank" rel="external">YouTube</a>上学习<a href="https://en.wikipedia.org/wiki/National_Programme_on_Technology_Enhanced_Learning" target="_blank" rel="external">NPTEL</a>的课程的时候，老师在讲到数据结构时提到一道编程题，我觉得很有意思便动手做了一下。虽然题目比较简单，只要你有清晰的思路相信很快能有自己的思路。然而这道题目对于我而言的重要意义在于提醒着我:    </p>
<blockquote>
<p>数据结构在程序设计中扮演着什么样的角色。  </p>
</blockquote>
<hr>
<p><strong>第一种思路 ： <em>遍历price，对于每一个 price ，向前计算比当前 price 低的天数，直到遇见比当前 price 高的 price为止。</em> </strong><br><code>然而，天使与魔鬼总是同时存在的，虽然算法容易想到，同时带来的却是较低的可扩展性(时间复杂度高).</code><br>算法的实现核心是两层循环，这也带来了O(N^2)的时间复杂度.  </p>
<p>  <img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elephant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.elephant.util.Print.print;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.elephant.util.Print.printnb;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*	n^2 time conplexity</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StockSpan1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">double</span> startTime = System.currentTimeMillis();</span><br><span class="line">		Double[] stock = &#123;<span class="number">100.0</span>, <span class="number">65.0</span>, <span class="number">60.0</span>, <span class="number">85.0</span>, <span class="number">80.0</span>, <span class="number">185.0</span>&#125;;</span><br><span class="line">		Integer[] res = <span class="keyword">new</span> Integer[stock.length];</span><br><span class="line">		res[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; stock.length; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">				<span class="keyword">if</span> (stock[i] &lt; stock[j]) &#123;</span><br><span class="line">					res[i] = i - j;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">0</span> &amp;&amp; stock[i] &gt; stock[j]) &#123;</span><br><span class="line">					res[i] = i - j + <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (Integer i : res)</span><br><span class="line">			printnb(i + <span class="string">", "</span>);</span><br><span class="line">		<span class="keyword">double</span> endTime = System.currentTimeMillis();</span><br><span class="line">		print(<span class="string">"程序运行时间： "</span> + (endTime - startTime) / <span class="number">1000</span> + <span class="string">"秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <strong>第二种思路, <em>维护一个递减的栈</em></strong> ( 栈的初始状态为:只有一个元素值为1), <strong><em>遍历 price.</em></strong>  </p>
<ol>
<li>如果当前 price <strong>小于</strong> 栈顶元素:<ul>
<li>res[i]=i - stack.top()</li>
<li>当前元素入栈</li>
</ul>
</li>
<li>如果当前 price <strong>大于</strong> 栈顶元素:  <ul>
<li>栈顶元素出栈,直到栈空或者满足第一个条件 </li>
</ul>
</li>
</ol>
<p>这个算法的时间复杂度分析较难.下面我试着按照我的理解分析一下,如果仅凭直观的感觉当你看到两层循环时,很容易理解成O(n^2)时间复杂度.<br>造成你觉得可能是O(n^2)时间复杂度的唯一可能是你觉得<code>stack.pop();</code>执行了 O(n^2)次.实际上每个price只可能进栈一次,而且出栈后便不会再进栈.所以<code>stack.pop();</code>最多执行了N次.</p>
<p><img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem2.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.elephant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.elephant.util.Print.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.elephant.data_structure.stack.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> ** Stock span</span><br><span class="line"> ** &lt;p&gt;</span><br><span class="line"> ** stack method,maintain a decreasing stack</span><br><span class="line"> ** &lt;p&gt;</span><br><span class="line"> ** Linear Time complexity</span><br><span class="line"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StockSpan</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">double</span> startTime = System.currentTimeMillis();</span><br><span class="line">		Double[] stock = &#123;<span class="number">100.0</span>, <span class="number">65.0</span>, <span class="number">65.0</span>, <span class="number">85.0</span>, <span class="number">80.0</span>, <span class="number">185.0</span>&#125;;</span><br><span class="line">		Integer[] res = <span class="keyword">new</span> Integer[stock.length];</span><br><span class="line">		Stack stack = <span class="keyword">new</span> ArrayStack();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// push first day into stack</span></span><br><span class="line">		stack.push(<span class="number">0</span>);</span><br><span class="line">		res[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// traverse from the second element</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; stock.length; i++) &#123;</span><br><span class="line">			<span class="keyword">while</span> (!stack.isEmpty() &amp;&amp; stock[i] &gt; stock[(<span class="keyword">int</span>) stack.top()]) &#123;</span><br><span class="line">				stack.pop();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (stack.isEmpty())</span><br><span class="line">				res[i] = i + <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				res[i] = i - (<span class="keyword">int</span>) stack.top();</span><br><span class="line">			&#125;</span><br><span class="line">			stack.push(i);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (Integer i : res) &#123;</span><br><span class="line">			printnb(i + <span class="string">", "</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> endTime = System.currentTimeMillis();</span><br><span class="line">		print(<span class="string">"程序运行时间： "</span> + (endTime - startTime) / <span class="number">1000</span> + <span class="string">"秒"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结:</strong>  恰当的理解和使用数据结构和算法将问题解决的更加漂亮的武器.<br>另附上我的<a href="https://github.com/newbeess/blog_code" target="_blank" rel="external">源代码</a>。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://fuchao.info/2016/04/19/Stock-Span-Problem/" data-id="cisb5mft40004jzpxh5qouh2j" class="article-share-link">分享到</a><div class="tags"><a href="/tags/algorithm/">algorithm</a></div><div class="post-nav"><a href="/2016/08/01/三道字符串题目/" class="pre">三道字符串题目</a><a href="/2016/04/04/Learning-Markdown/" class="next">Learning Markdown</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://fuchao.info"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/校招-职业生涯/" style="font-size: 15px;">校招 职业生涯</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/08/26/校招准备/">校招准备.md</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/03/LeetCode53/">LeetCode53</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/02/网易2016研发工程师编程题/">网易2016研发工程师编程题：小易的升级之路</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/三道字符串题目/">三道字符串题目</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/19/Stock-Span-Problem/">Stock-Span-Problem</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/Learning-Markdown/">Learning Markdown</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/newbeess" title="Github" target="_blank">Github</a><ul></ul><a href="http://weibo.com/u/1696309873?is_all=1#" title="新浪微博" target="_blank">新浪微博</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Code Stuff.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>