<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Stock-Span-Problem | Code Stuff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days before the given day where the price of stock was l">
<meta property="og:type" content="article">
<meta property="og:title" content="Stock-Span-Problem">
<meta property="og:url" content="http://yoursite.com/2016/04/19/Stock-Span-Problem/index.html">
<meta property="og:site_name" content="Code Stuff">
<meta property="og:description" content="We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days before the given day where the price of stock was l">
<meta property="og:image" content="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem.png =250x0">
<meta property="og:image" content="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem2.png =250x0">
<meta property="og:updated_time" content="2016-04-19T15:44:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Stock-Span-Problem">
<meta name="twitter:description" content="We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days before the given day where the price of stock was l">
<meta name="twitter:image" content="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem.png =250x0">
  
    <link rel="alternate" href="/atom.xml" title="Code Stuff" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Code Stuff</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Stock-Span-Problem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/19/Stock-Span-Problem/" class="article-date">
  <time datetime="2016-04-19T15:04:13.000Z" itemprop="datePublished">2016-04-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Stock-Span-Problem
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days before the given day where the price of stock was less than or equal to price at given day. For example, {100, 60,70,65, 80, 85} span will be {1, 1, 2, 1, 4, 5}  </p>
<blockquote>
<p>For first day span is always 1. In example we can see that for day 2 at 60, there is no day before it where price was less than 60. Hence span is 1 again. For day 3, price at day 2 (60) is less than 70, hence span is 2. Similarly, for day 4 and day 5. Remember days should be consecutive, that why span for day 4 is 1 even though there was a day 2 where price was less than 65. Hope this example clarifies the problem. Stock span problem is slightly complicated to understand but solution is pretty easy.    </p>
</blockquote>
</blockquote>
<p>这是最近在<a href="https://www.youtube.com/iit" target="_blank" rel="external">YouTube</a>上学习<a href="https://en.wikipedia.org/wiki/National_Programme_on_Technology_Enhanced_Learning" target="_blank" rel="external">NPTEL</a>的课程的时候，老师在讲到数据结构时提到一道编程题，我觉得很有意思便动手做了一下。虽然题目比较简单，只要你有清晰的思路相信很快能有自己的思路。然而这道题目对于我而言的重要意义在于提醒着我:    </p>
<blockquote>
<p>数据结构在程序设计中扮演着什么样的角色。  </p>
</blockquote>
<hr>
<p><strong>第一种思路 ： <em>遍历price，对于每一个 price ，向前计算比当前 price 低的天数，直到遇见比当前 price 高的 price为止。</em> </strong><br><code>然而，天使与魔鬼总是同时存在的，虽然算法容易想到，同时带来的却是较低的可扩展性(时间复杂度高).</code><br>算法的实现核心是两层循环，这也带来了O(N^2)的时间复杂度.</p>
<p>  <img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem.png =250x0" alt=""></p>
<pre><code>package com.elephant;

import static com.elephant.util.Print.print;
import static com.elephant.util.Print.printnb;


/**
*    n^2 time conplexity
*/
public class StockSpan1 {
    public static void main(String[] args) {
        double startTime = System.currentTimeMillis();
        Double[] stock = {100.0, 65.0, 60.0, 85.0, 80.0, 185.0};
        Integer[] res = new Integer[stock.length];
        res[0] = 1;
        for (int i = 1; i &lt; stock.length; i++) {
            for (int j = i - 1; j &gt;= 0; j--) {
                if (stock[i] &lt; stock[j]) {
                    res[i] = i - j;
                    break;
                } else if (j == 0 &amp;&amp; stock[i] &gt; stock[j]) {
                    res[i] = i - j + 1;
                }
            }
        }
        for (Integer i : res)
            printnb(i + &quot;, &quot;);
        double endTime = System.currentTimeMillis();
        print(&quot;程序运行时间： &quot; + (endTime - startTime) / 1000 + &quot;秒&quot;);
    }
}
</code></pre><p> <strong>第二种思路, <em>维护一个递减的栈</em></strong> ( 栈的初始状态为:只有一个元素值为1), <strong><em>遍历 price.</em></strong>  </p>
<ol>
<li>如果当前 price <strong>小于</strong> 栈顶元素:<ul>
<li>res[i]=i - stack.top()</li>
<li>当前元素入栈</li>
</ul>
</li>
<li>如果当前 price <strong>大于</strong> 栈顶元素:  <ul>
<li>栈顶元素出栈,直到栈空或者满足第一个条件 </li>
</ul>
</li>
</ol>
<p>这个算法的时间复杂度分析较难.下面我试着按照我的理解分析一下,如果仅凭直观的感觉当你看到两层循环时,很容易理解成O(n^2)时间复杂度.<br>造成你觉得可能是O(n^2)时间复杂度的唯一可能是你觉得<code>stack.pop();</code>执行了 O(n^2)次.实际上每个price只可能进栈一次,而且出栈后便不会再进栈.所以<code>stack.pop();</code>最多执行了N次.</p>
<p><img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem2.png =250x0" alt=""></p>
<pre><code>package com.elephant;

import static com.elephant.util.Print.*;

import com.elephant.data_structure.stack.*;

/**
 ** Stock span
 ** &lt;p&gt;
 ** stack method,maintain a decreasing stack
 ** &lt;p&gt;
 ** Linear Time complexity
 **/

public class StockSpan {
    public static void main(String[] args) {
        double startTime = System.currentTimeMillis();
        Double[] stock = {100.0, 65.0, 65.0, 85.0, 80.0, 185.0};
        Integer[] res = new Integer[stock.length];
        Stack stack = new ArrayStack();

        // push first day into stack
        stack.push(0);
        res[0] = 1;

        // traverse from the second element
        for (int i = 1; i &lt; stock.length; i++) {
            while (!stack.isEmpty() &amp;&amp; stock[i] &gt; stock[(int) stack.top()]) {
                stack.pop();
            }
            if (stack.isEmpty())
                res[i] = i + 1;
            else {
                res[i] = i - (int) stack.top();
            }
            stack.push(i);
        }


        for (Integer i : res) {
            printnb(i + &quot;, &quot;);
        }


        double endTime = System.currentTimeMillis();
        print(&quot;程序运行时间： &quot; + (endTime - startTime) / 1000 + &quot;秒&quot;);
        }
}
</code></pre><p><strong>总结:</strong>  恰当的理解和使用数据结构和算法将问题解决的更加漂亮的武器.<br>另附上我的<a href="https://github.com/newbeess/blog_code" target="_blank" rel="external">源代码</a>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/19/Stock-Span-Problem/" data-id="cin7ksv4c0000ujpx5iej4v03" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/04/04/Learning-Markdown/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Learning Markdown</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/markdown/" style="font-size: 10px;">markdown</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/19/Stock-Span-Problem/">Stock-Span-Problem</a>
          </li>
        
          <li>
            <a href="/2016/04/04/Learning-Markdown/">Learning Markdown</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 newbeess<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>