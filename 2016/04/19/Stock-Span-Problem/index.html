<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Stock-Span-Problem | Code Stuff</title>
  <meta name="author" content="newbeess">
  
  <meta name="description" content="We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days be">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Stock-Span-Problem"/>
  <meta property="og:site_name" content="Code Stuff"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.ico" rel="icon">
  

  <!-- CSS -->


  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Code Stuff</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/tags/热点文章/" title="All the tags.">
			  <i class="fa fa-fire"></i>热点文章
			</a>
		  </li>
		  
		  <li>
			<a href="/tags/博主推荐/" title="All the tags.">
			  <i class="fa fa-volume-up"></i>博主推荐
			</a>
		  </li>
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>文章归档
			</a>
		  </li>
		  
		  <li>
			<a href="/message" title="All the tags.">
			  <i class="fa fa-pencil"></i>给我留言
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-info-circle"></i>关于本站
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

		<!-- content -->

		<div class="slogan" style="margin-bottom: 17px">
		  <h4 style="margin-top: 0;color: #333;font-size:15px;font-weight: normal;">
			  当前位置&nbsp;:&nbsp;<a href="/" >首页&nbsp;</a>»&nbsp;文章分类&nbsp;:&nbsp;
			
		  &nbsp;</a>»&nbsp; Stock-Span-Problem </h4>
		</div>

		<div id="top_search"></div>
				 
		

		<div class="archive">	  
			<div id="archives"> 
				
				<header class="entry-header">
					<div class="entry-info" text-transform : capitalize>				     					      	      
							
						<span class="entry-date">
							<span class="fa fa-calendar" aria-hidden="true"></span>
							2016-04-19						      
						</span>
							  
							  
						<span class="author vcard">
							<span class="fa fa-user" aria-hidden="true"></span>
							<a href="/">newbeess</a> 	 	
						</span>

						<span class="comments-link">
							<span class="fa fa-comments" aria-hidden="true"></span>
							<span class="ds-thread-count" data-thread-key="2016/04/19/Stock-Span-Problem/">暂无评论</span>
						</span>						
							
					</div>	

									
					<h3 class="entry-title"> 
						<a href="/2016/04/19/Stock-Span-Problem/" >Stock-Span-Problem</a>
					</h3>		
						
					<span style="font-size:15px"><blockquote>
<p>We are given a list of prices of a stock for N number of days. We need to find the span for each day. Span is defined as number of consecutive days before the given day where the price of stock was less than or equal to price at given day. For example, {100, 60,70,65, 80, 85} span will be {1, 1, 2, 1, 4, 5}  </p>
<blockquote>
<p>For first day span is always 1. In example we can see that for day 2 at 60, there is no day before it where price was less than 60. Hence span is 1 again. For day 3, price at day 2 (60) is less than 70, hence span is 2. Similarly, for day 4 and day 5. Remember days should be consecutive, that why span for day 4 is 1 even though there was a day 2 where price was less than 65. Hope this example clarifies the problem. Stock span problem is slightly complicated to understand but solution is pretty easy.    </p>
</blockquote>
</blockquote>
<p>这是最近在<a href="https://www.youtube.com/iit" target="_blank" rel="external">YouTube</a>上学习<a href="https://en.wikipedia.org/wiki/National_Programme_on_Technology_Enhanced_Learning" target="_blank" rel="external">NPTEL</a>的课程的时候，老师在讲到数据结构时提到一道编程题，我觉得很有意思便动手做了一下。虽然题目比较简单，只要你有清晰的思路相信很快能有自己的思路。然而这道题目对于我而言的重要意义在于提醒着我:    </p>
<blockquote>
<p>数据结构在程序设计中扮演着什么样的角色。  </p>
</blockquote>
<hr>
<p><strong>第一种思路 ： <em>遍历price，对于每一个 price ，向前计算比当前 price 低的天数，直到遇见比当前 price 高的 price为止。</em> </strong><br><code>然而，天使与魔鬼总是同时存在的，虽然算法容易想到，同时带来的却是较低的可扩展性(时间复杂度高).</code><br>算法的实现核心是两层循环，这也带来了O(N^2)的时间复杂度.</p>
<p>  <img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem.png =250x0" alt=""></p>
<pre><code>package com.elephant;

import static com.elephant.util.Print.print;
import static com.elephant.util.Print.printnb;


/**
*    n^2 time conplexity
*/
public class StockSpan1 {
    public static void main(String[] args) {
        double startTime = System.currentTimeMillis();
        Double[] stock = {100.0, 65.0, 60.0, 85.0, 80.0, 185.0};
        Integer[] res = new Integer[stock.length];
        res[0] = 1;
        for (int i = 1; i &lt; stock.length; i++) {
            for (int j = i - 1; j &gt;= 0; j--) {
                if (stock[i] &lt; stock[j]) {
                    res[i] = i - j;
                    break;
                } else if (j == 0 &amp;&amp; stock[i] &gt; stock[j]) {
                    res[i] = i - j + 1;
                }
            }
        }
        for (Integer i : res)
            printnb(i + &quot;, &quot;);

        double endTime = System.currentTimeMillis();
        print(&quot;程序运行时间： &quot; + (endTime - startTime) / 1000 + &quot;秒&quot;);
    }
}
</code></pre><p> <strong>第二种思路, <em>维护一个递减的栈</em></strong> ( 栈的初始状态为:只有一个元素值为1), <strong><em>遍历 price.</em></strong>  </p>
<ol>
<li>如果当前 price <strong>小于</strong> 栈顶元素:<ul>
<li>res[i]=i - stack.top()</li>
<li>当前元素入栈</li>
</ul>
</li>
<li>如果当前 price <strong>大于</strong> 栈顶元素:  <ul>
<li>栈顶元素出栈,直到栈空或者满足第一个条件 </li>
</ul>
</li>
</ol>
<p>这个算法的时间复杂度分析较难.下面我试着按照我的理解分析一下,如果仅凭直观的感觉当你看到两层循环时,很容易理解成O(n^2)时间复杂度.<br>造成你觉得可能是O(n^2)时间复杂度的唯一可能是你觉得<code>stack.pop();</code>执行了 O(n^2)次.实际上每个price只可能进栈一次,而且出栈后便不会再进栈.所以<code>stack.pop();</code>最多执行了N次.</p>
<p><img src="http://d1gjlxt8vb0knt.cloudfront.net//wp-content/uploads/StockSpanProblem2.png =250x0" alt=""></p>
<pre><code>package com.elephant;

import static com.elephant.util.Print.*;

import com.elephant.data_structure.stack.*;

/**
 ** Stock span
 ** &lt;p&gt;
 ** stack method,maintain a decreasing stack
 ** &lt;p&gt;
 ** Linear Time complexity
 **/

public class StockSpan {
    public static void main(String[] args) {
        double startTime = System.currentTimeMillis();
        Double[] stock = {100.0, 65.0, 65.0, 85.0, 80.0, 185.0};
        Integer[] res = new Integer[stock.length];
        Stack stack = new ArrayStack();

        // push first day into stack
        stack.push(0);
        res[0] = 1;

        // traverse from the second element
        for (int i = 1; i &lt; stock.length; i++) {
            while (!stack.isEmpty() &amp;&amp; stock[i] &gt; stock[(int) stack.top()]) {
                stack.pop();
            }
            if (stack.isEmpty())
                res[i] = i + 1;
            else {
                res[i] = i - (int) stack.top();
            }
            stack.push(i);
        }


        for (Integer i : res) {
            printnb(i + &quot;, &quot;);
        }


        double endTime = System.currentTimeMillis();
        print(&quot;程序运行时间： &quot; + (endTime - startTime) / 1000 + &quot;秒&quot;);
        }
}
</code></pre><p><strong>总结:</strong>  恰当的理解和使用数据结构和算法将问题解决的更加漂亮的武器.<br>另附上我的<a href="https://github.com/newbeess/blog_code" target="_blank" rel="external">源代码</a>。</p>
</span>
				</header>

				<!-- share -->
				
					

					
     <footer class="entry-meta">      

	    <div class="fenlei" style="font-size:13.5px">
			<span class="entry-categories">
				<span class="fa fa-folder" aria-hidden="true"></span> 

				

			</span>
			
			<span class="entry-tags">        
				<span class="fa fa-tags" aria-hidden="true"></span> 

				

			</span>
		</div>

     
		<!-- JiaThis Button BEGIN -->
		<div class="jiathis_style" style="float:right;">
			<span class="jiathis_txt">分享到：</span>
			<a class="jiathis_button_qzone">QQ空间</a>
			<a class="jiathis_button_tsina">新浪微博</a>
			<a class="jiathis_button_weixin">微信</a>
			<a class="jiathis_button_copy">复制</a>
			<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
			<a class="jiathis_counter_style"></a>
		</div>
		<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
		<!-- JiaThis Button END -->
		<br>
    </footer>


				
			</div>	
		</div>	 	        

		 
				

				
				   <p class="p2">Next <a href="/2016/04/04/Learning-Markdown/">Learning Markdown</a></p> 
			
		
		<!-- comment -->
		
<section id="comment">
  
  	 <div class="ds-thread" data-thread-key="2016/04/19/Stock-Span-Problem/" data-title="Stock-Span-Problem" data-url="http://yoursite.com/2016/04/19/Stock-Span-Problem/"></div>  
  
</section>

		
	</div> <!-- col-md-9/col-md-12 -->	

	
		<div id="side_meta">
			
      <div class="col-md-3">
	      <div id="sidebar">
	      
  <div class="form-group has-success has-feedback" id="site_search">
    <form class="site-search-form">
        <input type="text" id="st-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control" />
    </form>
  </div>  

	      <style type="text/css">
  .cls_container{height:24px;overflow:hidden;}
  .cls_container ul{list-style-type:none;margin:0;padding:0;margin-left:0px;}
  .cls_container ul li{height:24px;line-height:24px;float:left;display:inline;}
</style>

<div class="widget">
	<h4 style="font-weight: bold; color: #333;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif">Notification</h4>

	<div id="myscroll" class="cls_container">
		<ul>
		  <li><span style="color:red"><i class="fa fa-warning"></i>欢迎访问本站!</span></li></br>
		  <li><span style="color:red"><i class="fa fa-warning"></i>本站内容已经全部进行迁移</span></li></br>
		  <li><span style="color:red"><i class="fa fa-warning"></i>谷歌浏览器访问本站效果最佳!</span></li></br>
		  <li><span style="color:red"><i class="fa fa-warning"></i>若URL失效，请使用本站内部搜索</span></li></br>
		</ul>
	</div>

	<div id="showhint"></div>
</div>

<script type="text/javascript">
	function $(element){
	 if(arguments.length>1){
	  for(var i=0,length=arguments.length,elements=[];i<length;i++){
	   elements.push($(arguments[i]));
	  }
	  return elements;
	 }
	 if(typeof element=="string"){
	  return document.getElementById(element);
	 }else{
	  return element;
	 }
	}
	var Class={
	 create:function(){
	  return function(){
	   this.initialize.apply(this,arguments);
	  }
	 }
	}
	Function.prototype.bind=function(object){
	 var method=this;
	 return function(){
	  method.apply(object,arguments);
	 }
	}
	var Scroll=Class.create();
	Scroll.prototype={
	 initialize:function(element,height){
	  this.element=$(element);
	  this.element.innerHTML+=this.element.innerHTML;
	  this.height=height;
	  this.maxHeight=this.element.scrollHeight/2;
	  this.counter=0;
	  this.scroll();
	  this.timer="";
	  this.element.onmouseover=this.stop.bind(this);
	  this.element.onmouseout=function(){this.timer=setTimeout(this.scroll.bind(this),1000);}.bind(this);
	 },
	 scroll:function(){
	  if(this.element.scrollTop<this.maxHeight){
	   this.element.scrollTop++;
	   this.counter++;
	  }else{
	   this.element.scrollTop=0;
	   this.counter=0;
	  }
	  if(this.counter<this.height){
	   this.timer=setTimeout(this.scroll.bind(this),20);
	  }else{
	   this.counter=0;
	   this.timer=setTimeout(this.scroll.bind(this),3000);
	  }
	 },
	 stop:function(){
	  clearTimeout(this.timer);
	 }
	}
	var myscroll=new Scroll("myscroll",24);
</script>


	      <!-- toc -->	      
	      	      

	      	
	      
	<div class="widget">
		<h4 style="font-weight: bold; color: #333 ">Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/markdown/">markdown<span>1</span></a></li>
		
		 
		</ul>
	</div>


	      
<div class="widget">
	<h4 style="font-weight: bold; color: #333;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif">Friend Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li style="font-size:14px"><i class="fa fa-share"></i><a href="http://hexo.io" title="My Linkin account." target="_blank"]);">Hexo</a></li>
	
		<li style="font-size:14px"><i class="fa fa-github"></i><a href="https://github.com/newbeess" title="My Github account." target="_blank"]);">我的github</a></li>
	
		<li style="font-size:14px"><i class="fa fa-trash"></i><a href="http://yjiehn.sinaapp.com" title="My Linkin account." target="_blank"]);">我的旧版博客</a></li>
	
		<li style="font-size:14px"><i class="fa fa-cloud-upload"></i><a href="http://www.qiniu.com" title="My Weibo account." target="_blank"]);">七牛云存储</a></li>
	
		<li style="font-size:14px"><i class="fa fa-chain"></i><a href="http://netlab.pkusz.edu.cn" title="My Weibo account." target="_blank"]);">北大互联网信息工程研发中心</a></li>
	
		<li style="font-size:14px"><i class="fa fa-chain"></i><a href="http://cs.whu.edu.cn" title="My Weibo account." target="_blank"]);">武汉大学 计算机学院</a></li>
	
		<li style="font-size:14px"><i class="fa fa-chain"></i><a href="http://github.com/wzpan/hexo-theme-freemind" title="My Weibo account." target="_blank"]);">Hexo-Theme-Freemind</a></li>
	
		<li style="font-size:14px"><i class="fa fa-chain"></i><a href="http://www.wengweitao.com" title="My Weibo account." target="_blank"]);">WWT的博客</a></li>
	
	</ul>
</div>


	      <div class="widget">
	<h4 style="font-weight: bold; color: #333;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif">Recent Comments</h4>
	<ul class="ds-recent-comments" data-num-items="5" data-show-avatars="1" data-show-time="0" data-show-admin="1" data-excerpt-length="100" ></ul>
	
	<script type="text/javascript">
	    var duoshuoQuery = {short_name:"rudy-yuan"};
	    (function() {
	    var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
	</script>

</div>


	
	      <section id="recent-visitors" class="widget widget_recent_comments">
	<h4 style="font-weight: bold; color: #333;font-family: "Helvetica Neue", Helvetica, Arial, sans-serif">Recent Visitors</h4>
  	<div class="panelbody clearfix"><ul class="ds-recent-visitors" data-num-items="30"></ul></div>
</section>    
	      </div> <!-- sidebar -->
      </div> <!-- col-md-3 -->

		</div>
			

</div><!-- row -->


	<script type="text/javascript">
	  var duoshuoQuery = { short_name: 'rudy-yuan' };
	  (function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';
		ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	</script>



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  newbeess &copy; 2013-2016.
  
       Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, <a href="https://swiftype.com/" target="_blank">Swiftype</a> and <a href="http://www.qiniu.com/" target="_blank">七牛云存储</a>.
      <i class="fa fa-sitemap %>"></i> <a href="/sitemap.xml" target="_blank"> 站点地图</a>. <a href="http://www.miitbeian.gov.cn/">粤ICP备15038546号</a>.
      <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1255163192'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1255163192' type='text/javascript'%3E%3C/script%3E"));</script>   
</p> </footer>
</div> <!-- container-narrow -->
  
  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'YYG5W2xNQTns7U8J3YqW','2.0.0');
  </script>



  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
